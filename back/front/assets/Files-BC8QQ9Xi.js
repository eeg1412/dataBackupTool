import{_ as F}from"./Layout-BVgoVKe6.js";import{f as D,g as I}from"./index-Dm-C4vXQ.js";import{h as N,i as A,j as E,r as d,o as a,a as t,c as o,t as i,F as y,d as m,k as f,l as w}from"./index-D_D1NxvD.js";const L={class:"space-y-4 sm:space-y-6"},P={key:0,class:"flex justify-center py-12"},R={key:1,class:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 p-4 rounded-lg text-sm sm:text-base"},S={key:0,class:"text-center py-12 text-gray-500 dark:text-gray-400"},W={key:1,class:"flex items-center flex-wrap gap-1 text-sm text-gray-500 dark:text-gray-400"},U=["onClick"],Z={key:1,class:"text-gray-900 dark:text-white font-medium truncate max-w-30 sm:max-w-none"},q={key:2,class:"grid gap-3 sm:gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3"},G={class:"flex items-start justify-between"},J={class:"flex items-center space-x-3 min-w-0"},K={class:"min-w-0"},O=["onClick"],Q={class:"text-xs text-gray-500 dark:text-gray-400 truncate mt-0.5"},X={class:"mt-3 sm:mt-4 flex space-x-2"},Y=["onClick"],ee=["onClick","disabled"],te={key:3,class:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden"},re={class:"px-3 sm:px-4 py-2.5 sm:py-3 bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between gap-2"},se=["disabled"],ae={key:0,class:"flex justify-center py-8"},oe={key:1,class:"text-center py-8 text-gray-500 dark:text-gray-400 text-sm"},le={key:2,class:"divide-y divide-gray-100 dark:divide-gray-700"},ne={class:"flex items-center space-x-2 sm:space-x-3 min-w-0"},ie={key:0,class:"w-5 h-5 text-yellow-500 shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},de={key:1,class:"w-5 h-5 text-gray-400 dark:text-gray-500 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ce=["onClick"],ue={key:3,class:"text-sm text-gray-700 dark:text-gray-300 truncate"},ve=["onClick","disabled"],ke={__name:"Files",setup(pe){const k=d(!0),g=d(!1),p=d(""),x=d([]),l=d(""),h=d([]),c=d(""),u=d([]),_=w(()=>{if(!l.value)return"";const s=l.value.replace(/[\\/]+$/,"").split(/[\\/]/);return s[s.length-1]||l.value}),C=w(()=>{if(!l.value)return[];const s=x.value.find(n=>l.value.startsWith(n.path));if(!s)return[_.value];const e=l.value.slice(s.path.length).replace(/^[\\/]/,""),r=[s.name];return e&&r.push(...e.split(/[\\/]/).filter(Boolean)),r}),$=w(()=>[...h.value].sort((s,e)=>s.isDirectory!==e.isDirectory?s.isDirectory?-1:1:s.name.localeCompare(e.name)));N(async()=>{await M()});async function M(){k.value=!0,p.value="";try{const s=await D.list();x.value=s.data.directories}catch(s){p.value=s.response?.data?.error||"加载目录列表失败"}finally{k.value=!1}}async function v(s){g.value=!0,l.value&&u.value.push(l.value),l.value=s;try{const e=await D.browse(s);h.value=e.data.items}catch(e){h.value=[],p.value=e.response?.data?.error||"无法读取目录"}finally{g.value=!1}}function V(){if(u.value.length>0){const s=u.value.pop();l.value="",v(s),u.value.pop()}else B()}function B(){l.value="",h.value=[],u.value=[]}function z(s){const e=x.value.find(T=>l.value.startsWith(T.path));if(!e)return;if(s===0){l.value="",v(e.path),u.value=[];return}const j=l.value.slice(e.path.length).replace(/^[\\/]/,"").split(/[\\/]/).filter(Boolean).slice(0,s).join("/"),H=e.path+"/"+j;u.value=[],l.value="",v(H)}async function b(s,e){c.value=s;try{const r=await I("files",{path:s}),n=document.createElement("a");n.href=r,n.download=`${e||"download"}.zip`,document.body.appendChild(n),n.click(),document.body.removeChild(n)}catch(r){console.error("获取下载凭证失败:",r)}finally{setTimeout(()=>{c.value=""},2e3)}}return(s,e)=>(a(),A(F,null,{default:E(()=>[t("div",L,[e[10]||(e[10]=t("div",{class:"flex items-center justify-between"},[t("h2",{class:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white"}," 文件管理 ")],-1)),k.value?(a(),o("div",P,[...e[1]||(e[1]=[t("svg",{class:"animate-spin h-8 w-8 text-blue-600",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})],-1)])])):p.value?(a(),o("div",R,i(p.value),1)):(a(),o(y,{key:2},[x.value.length===0?(a(),o("div",S,[...e[2]||(e[2]=[t("svg",{class:"mx-auto h-12 w-12 mb-4 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1),t("p",null,"没有配置任何目录",-1)])])):m("",!0),l.value?(a(),o("nav",W,[t("button",{onClick:B,class:"hover:text-blue-600 dark:hover:text-blue-400 transition-colors"}," 全部目录 "),(a(!0),o(y,null,f(C.value,(r,n)=>(a(),o("span",{key:n,class:"flex items-center space-x-1"},[e[3]||(e[3]=t("svg",{class:"w-4 h-4 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)),n<C.value.length-1?(a(),o("button",{key:0,onClick:j=>z(n),class:"hover:text-blue-600 dark:hover:text-blue-400 transition-colors truncate max-w-30 sm:max-w-none"},i(r),9,U)):(a(),o("span",Z,i(r),1))]))),128))])):m("",!0),l.value?(a(),o("div",te,[t("div",re,[t("div",{class:"flex items-center space-x-2 min-w-0"},[t("button",{onClick:V,class:"p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors shrink-0"},[...e[5]||(e[5]=[t("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),e[6]||(e[6]=t("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 truncate"},"当前目录",-1))]),t("button",{onClick:e[0]||(e[0]=r=>b(l.value,_.value)),disabled:!!c.value,class:"px-2.5 sm:px-3 py-1.5 text-xs sm:text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 shrink-0 whitespace-nowrap"},i(c.value===l.value?"准备中...":"下载当前目录"),9,se)]),g.value?(a(),o("div",ae,[...e[7]||(e[7]=[t("svg",{class:"animate-spin h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})],-1)])])):h.value.length===0?(a(),o("div",oe," 目录为空 ")):(a(),o("div",le,[(a(!0),o(y,null,f($.value,r=>(a(),o("div",{key:r.path,class:"flex items-center justify-between px-3 sm:px-4 py-2 sm:py-2.5 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors"},[t("div",ne,[r.isDirectory?(a(),o("svg",ie,[...e[8]||(e[8]=[t("path",{d:"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"},null,-1)])])):(a(),o("svg",de,[...e[9]||(e[9]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)])])),r.isDirectory?(a(),o("button",{key:2,onClick:n=>v(r.path),class:"text-sm text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors truncate"},i(r.name),9,ce)):(a(),o("span",ue,i(r.name),1))]),r.isDirectory?(a(),o("button",{key:0,onClick:n=>b(r.path,r.name),disabled:!!c.value,class:"ml-2 px-2 sm:px-2.5 py-1 text-xs bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded hover:bg-blue-100 dark:hover:bg-blue-900/50 transition-colors disabled:opacity-50 shrink-0"}," 下载 ",8,ve)):m("",!0)]))),128))]))])):(a(),o("div",q,[(a(!0),o(y,null,f(x.value,r=>(a(),o("div",{key:r.path,class:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 sm:p-5 hover:shadow-md transition-shadow"},[t("div",G,[t("div",J,[e[4]||(e[4]=t("div",{class:"p-2 bg-blue-50 dark:bg-blue-900/30 rounded-lg shrink-0"},[t("svg",{class:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})])],-1)),t("div",K,[t("button",{onClick:n=>v(r.path),class:"text-sm font-medium text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors text-left truncate block max-w-full"},i(r.name),9,O),t("p",Q,i(r.path),1)])])]),t("div",X,[t("button",{onClick:n=>v(r.path),class:"flex-1 px-3 py-1.5 text-sm bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"}," 浏览 ",8,Y),t("button",{onClick:n=>b(r.path,r.name),disabled:c.value===r.path,class:"flex-1 px-3 py-1.5 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50"},i(c.value===r.path?"准备中...":"下载 ZIP"),9,ee)])]))),128))]))],64))])]),_:1}))}};export{ke as default};
