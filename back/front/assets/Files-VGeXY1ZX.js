import{_ as E}from"./Layout-BRAVM_WB.js";import{f as V,g as I}from"./index-C5w0Yef5.js";import{h as L,i as R,j as S,r as i,o as s,a,c as o,t as c,d as b,F as m,k as C,l as D}from"./index-1WJulIZi.js";const W={class:"space-y-4 sm:space-y-6"},U={class:"flex items-center justify-between flex-wrap gap-2"},q=["disabled"],G={key:0,class:"flex justify-center py-12"},J={key:1,class:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 p-4 rounded-lg text-sm sm:text-base"},K={key:0,class:"text-center py-12 text-gray-500 dark:text-gray-400"},O={key:1,class:"flex items-center flex-wrap gap-1 text-sm text-gray-500 dark:text-gray-400"},Q=["onClick"],X={key:1,class:"text-gray-900 dark:text-white font-medium truncate max-w-30 sm:max-w-none"},Y={key:2,class:"grid gap-3 sm:gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3"},Z={class:"flex items-start justify-between"},ee={class:"flex items-center space-x-3 min-w-0"},te={class:"min-w-0"},ae=["onClick"],re={class:"text-xs text-gray-500 dark:text-gray-400 truncate mt-0.5"},se={class:"mt-3 sm:mt-4 flex space-x-2"},oe=["onClick"],le=["onClick","disabled"],ne={key:3,class:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden"},ie={class:"px-3 sm:px-4 py-2.5 sm:py-3 bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between gap-2"},de=["disabled"],ce={key:0,class:"flex justify-center py-8"},ue={key:1,class:"text-center py-8 text-gray-500 dark:text-gray-400 text-sm"},ve={key:2,class:"divide-y divide-gray-100 dark:divide-gray-700"},pe={class:"flex items-center space-x-2 sm:space-x-3 min-w-0"},he={key:0,class:"w-5 h-5 text-yellow-500 shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},xe={key:1,class:"w-5 h-5 text-gray-400 dark:text-gray-500 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ge=["onClick"],ye={key:3,class:"text-sm text-gray-700 dark:text-gray-300 truncate"},ke=["onClick","disabled"],_e={__name:"Files",setup(be){const f=i(!0),w=i(!1),h=i(""),d=i([]),l=i(""),x=i([]),u=i(""),v=i([]),g=i(!1),y=i(0),_=i(0),B=D(()=>{if(!l.value)return"";const r=l.value.replace(/[\\/]+$/,"").split(/[\\/]/);return r[r.length-1]||l.value}),$=D(()=>{if(!l.value)return[];const r=d.value.find(n=>l.value.startsWith(n.path));if(!r)return[B.value];const e=l.value.slice(r.path.length).replace(/^[\\/]/,""),t=[r.name];return e&&t.push(...e.split(/[\\/]/).filter(Boolean)),t}),z=D(()=>[...x.value].sort((r,e)=>r.isDirectory!==e.isDirectory?r.isDirectory?-1:1:r.name.localeCompare(e.name)));L(async()=>{await T()});async function T(){f.value=!0,h.value="";try{const r=await V.list();d.value=r.data.directories}catch(r){h.value=r.response?.data?.error||"加载目录列表失败"}finally{f.value=!1}}async function p(r){w.value=!0,l.value&&v.value.push(l.value),l.value=r;try{const e=await V.browse(r);x.value=e.data.items}catch(e){x.value=[],h.value=e.response?.data?.error||"无法读取目录"}finally{w.value=!1}}function H(){if(v.value.length>0){const r=v.value.pop();l.value="",p(r),v.value.pop()}else j()}function j(){l.value="",x.value=[],v.value=[]}function F(r){const e=d.value.find(P=>l.value.startsWith(P.path));if(!e)return;if(r===0){l.value="",p(e.path),v.value=[];return}const M=l.value.slice(e.path.length).replace(/^[\\/]/,"").split(/[\\/]/).filter(Boolean).slice(0,r).join("/"),N=e.path+"/"+M;v.value=[],l.value="",p(N)}async function k(r,e){u.value=r;try{const t=await I(r),n=document.createElement("a");n.href=t,n.download=`${e||"download"}.zip`,document.body.appendChild(n),n.click(),document.body.removeChild(n)}catch(t){console.error("获取下载凭证失败:",t),alert("下载失败: "+(t.response?.data?.error||t.message))}finally{setTimeout(()=>{u.value=""},2e3)}}async function A(){if(!g.value&&confirm(`确定要依次下载所有 ${d.value.length} 个目录吗？`)){g.value=!0,y.value=0,_.value=d.value.length;for(let r=0;r<d.value.length;r++){const e=d.value[r];y.value=r+1;try{await k(e.path,e.name),await new Promise(t=>setTimeout(t,1500))}catch(t){if(console.error(`下载目录 ${e.name} 失败:`,t),!confirm(`下载 ${e.name} 失败，是否继续下载其他目录？`))break}}g.value=!1,y.value=0,_.value=0}}return(r,e)=>(s(),R(E,null,{default:S(()=>[a("div",W,[a("div",U,[e[1]||(e[1]=a("h2",{class:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-white"}," 文件管理 ",-1)),!l.value&&d.value.length>0?(s(),o("button",{key:0,onClick:A,disabled:!!u.value||g.value,class:"px-3 py-1.5 text-xs sm:text-sm bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors disabled:opacity-50 whitespace-nowrap"},c(g.value?`批量下载中 (${y.value}/${_.value})`:"一键下载全部"),9,q)):b("",!0)]),f.value?(s(),o("div",G,[...e[2]||(e[2]=[a("svg",{class:"animate-spin h-8 w-8 text-blue-600",fill:"none",viewBox:"0 0 24 24"},[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})],-1)])])):h.value?(s(),o("div",J,c(h.value),1)):(s(),o(m,{key:2},[d.value.length===0?(s(),o("div",K,[...e[3]||(e[3]=[a("svg",{class:"mx-auto h-12 w-12 mb-4 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1),a("p",null,"没有配置任何目录",-1)])])):b("",!0),l.value?(s(),o("nav",O,[a("button",{onClick:j,class:"hover:text-blue-600 dark:hover:text-blue-400 transition-colors"}," 全部目录 "),(s(!0),o(m,null,C($.value,(t,n)=>(s(),o("span",{key:n,class:"flex items-center space-x-1"},[e[4]||(e[4]=a("svg",{class:"w-4 h-4 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)),n<$.value.length-1?(s(),o("button",{key:0,onClick:M=>F(n),class:"hover:text-blue-600 dark:hover:text-blue-400 transition-colors truncate max-w-30 sm:max-w-none"},c(t),9,Q)):(s(),o("span",X,c(t),1))]))),128))])):b("",!0),l.value?(s(),o("div",ne,[a("div",ie,[a("div",{class:"flex items-center space-x-2 min-w-0"},[a("button",{onClick:H,class:"p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors shrink-0"},[...e[6]||(e[6]=[a("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),e[7]||(e[7]=a("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 truncate"},"当前目录",-1))]),a("button",{onClick:e[0]||(e[0]=t=>k(l.value,B.value)),disabled:!!u.value,class:"px-2.5 sm:px-3 py-1.5 text-xs sm:text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 shrink-0 whitespace-nowrap"},c(u.value===l.value?"准备中...":"下载当前目录"),9,de)]),w.value?(s(),o("div",ce,[...e[8]||(e[8]=[a("svg",{class:"animate-spin h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24"},[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})],-1)])])):x.value.length===0?(s(),o("div",ue," 目录为空 ")):(s(),o("div",ve,[(s(!0),o(m,null,C(z.value,t=>(s(),o("div",{key:t.path,class:"flex items-center justify-between px-3 sm:px-4 py-2 sm:py-2.5 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors"},[a("div",pe,[t.isDirectory?(s(),o("svg",he,[...e[9]||(e[9]=[a("path",{d:"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"},null,-1)])])):(s(),o("svg",xe,[...e[10]||(e[10]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)])])),t.isDirectory?(s(),o("button",{key:2,onClick:n=>p(t.path),class:"text-sm text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors truncate"},c(t.name),9,ge)):(s(),o("span",ye,c(t.name),1))]),t.isDirectory?(s(),o("button",{key:0,onClick:n=>k(t.path,t.name),disabled:!!u.value,class:"ml-2 px-2 sm:px-2.5 py-1 text-xs bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded hover:bg-blue-100 dark:hover:bg-blue-900/50 transition-colors disabled:opacity-50 shrink-0"}," 下载 ",8,ke)):b("",!0)]))),128))]))])):(s(),o("div",Y,[(s(!0),o(m,null,C(d.value,t=>(s(),o("div",{key:t.path,class:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 sm:p-5 hover:shadow-md transition-shadow"},[a("div",Z,[a("div",ee,[e[5]||(e[5]=a("div",{class:"p-2 bg-blue-50 dark:bg-blue-900/30 rounded-lg shrink-0"},[a("svg",{class:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})])],-1)),a("div",te,[a("button",{onClick:n=>p(t.path),class:"text-sm font-medium text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors text-left truncate block max-w-full"},c(t.name),9,ae),a("p",re,c(t.path),1)])])]),a("div",se,[a("button",{onClick:n=>p(t.path),class:"flex-1 px-3 py-1.5 text-sm bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"}," 浏览 ",8,oe),a("button",{onClick:n=>k(t.path,t.name),disabled:u.value===t.path,class:"flex-1 px-3 py-1.5 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50"},c(u.value===t.path?"准备中...":"下载 备份"),9,le)])]))),128))]))],64))])]),_:1}))}};export{_e as default};
